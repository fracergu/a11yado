---
import Layout from '../../layouts/Layout.astro'
import Card from '../../components/Card.astro'
import CardGrid from '../../components/CardGrid.astro'
import Checklist from '../../components/Checklist.astro'
import ToolsSection from '../../components/ToolsSection.astro'
import Banner from '../../components/Banner.astro'
import BannerGrid from '../../components/BannerGrid.astro'
import OrderedList from '../../components/OrderedList.astro'
import OrderedListItem from '../../components/OrderedListItem.astro'
import Header from '../../components/Header.astro'

const checklistItems = [
  '¬øEl outline es de al menos 2px de grosor?',
  '¬øHay contraste 3:1+ entre estados enfocado/no enfocado?',
  '¬øEl indicador contrasta 3:1+ con colores adyacentes?',
  '¬øLos elementos enfocados no se ocultan tras otros contenidos?',
  '¬øEl estilo comunica claramente "enfocado"?',
  '¬øFunciona en modo claro y oscuro?',
  '¬øTodos los elementos interactivos tienen estado de foco?',
  '¬øEl orden de tabulaci√≥n es l√≥gico?',
]

const focusTools = [
  {
    name: 'Navegaci√≥n por teclado',
    description: 'Usa solo Tab, Shift+Tab, Enter, Space',
  },
  {
    name: 'Herramientas de contraste',
    description: 'WebAIM, Colour Contrast Analyser',
  },
  {
    name: 'DevTools',
    description: 'Inspecciona estados :focus en el navegador',
  },
]
---

<Layout
  title="Estados de Foco - Gu√≠a de Accesibilidad | a11yado"
  description="Aprende a crear estados de foco accesibles. Indicadores visibles, dise√±o inclusivo para navegaci√≥n por teclado siguiendo WCAG 2.2."
  type="article"
  canonical="/a11yado/guides/focus-states"
>
  <article>
    <Header
      title="Estados de Foco"
      description="Los estados de foco son indicadores visuales que muestran qu√© elemento est√° actualmente seleccionado para interacci√≥n por teclado. Son esenciales para la navegaci√≥n accesible."
    />

    <section>
      <h2>¬øPor qu√© son importantes?</h2>
      <p>
        Los estados de foco permiten a los usuarios navegar tu sitio usando solo
        el teclado. Sin indicadores claros, es imposible saber d√≥nde est√°s en la
        p√°gina.
      </p>

      <Banner
        title="üë• Usuarios que dependen de estados de foco"
        variant="concept"
      >
        <ul>
          <li>
            <strong>Usuarios de teclado:</strong> Personas con discapacidades motoras
            que navegan usando <a
              href="https://www.w3.org/WAI/WCAG22/Understanding/keyboard.html"
              target="_blank"
              rel="noopener">solo el teclado (WCAG 2.1.1)</a
            >
          </li>
          <li>
            <strong>Usuarios de lectores de pantalla:</strong> Personas con discapacidades
            visuales
          </li>
          <li>
            <strong>Usuarios de switch control:</strong> Personas con movilidad limitada
          </li>
          <li>
            <strong>Usuarios avanzados:</strong> Desarrolladores y power users que
            prefieren el teclado
          </li>
        </ul>
      </Banner>
    </section>

    <section>
      <h2>Las 4 reglas oficiales de WCAG</h2>
      <p>
        Para que un estado de foco sea accesible, debe cumplir estos 4 criterios
        oficiales m√°s 1 regla bonus de usabilidad.
      </p>

      <OrderedList>
        <OrderedListItem number={1} title="Tama√±o del Indicador">
          <p>
            El indicador de foco debe ser al menos tan grande como un per√≠metro
            de 2px CSS alrededor del componente seg√∫n <a
              href="https://www.w3.org/WAI/WCAG22/Understanding/focus-appearance.html"
              target="_blank"
              rel="noopener">WCAG 2.4.11: Focus Appearance</a
            >. Soluci√≥n simple: Usa un outline s√≥lido de 2px o m√°s grueso.
          </p>
        </OrderedListItem>

        <OrderedListItem number={2} title="Contraste de Color">
          <p>
            Debe haber contraste 3:1 o mayor entre los estados enfocado y no
            enfocado seg√∫n <a
              href="https://www.w3.org/WAI/WCAG22/Understanding/non-text-contrast.html"
              target="_blank"
              rel="noopener">WCAG 1.4.11: Non-text Contrast</a
            >. Ejemplo: Fondo blanco ‚Üí outline azul = cambio de blanco a azul.
          </p>
        </OrderedListItem>

        <OrderedListItem number={3} title="Contraste Adyacente">
          <p>
            El indicador debe tener contraste 3:1 o mayor contra los colores
            adyacentes (fondo y componente) seg√∫n <a
              href="https://www.w3.org/WAI/WCAG22/Understanding/non-text-contrast.html"
              target="_blank"
              rel="noopener">WCAG 1.4.11</a
            >. Tip: Usa un gap entre el outline y el elemento para simplificar.
          </p>
        </OrderedListItem>

        <OrderedListItem number={4} title="No Oculto">
          <p>
            El componente enfocado no debe estar oculto por contenido como
            headers pegajosos o modales seg√∫n <a
              href="https://www.w3.org/WAI/WCAG22/Understanding/focus-not-obscured-minimum.html"
              target="_blank"
              rel="noopener">WCAG 2.4.12: Focus Not Obscured</a
            >. Cuidado con: Sticky headers, footers y overlays.
          </p>
        </OrderedListItem>
      </OrderedList>

      <Banner title="üéØ Se√±alizadores apropiados" variant="concept">
        <p>
          El estilo debe <strong>comunicar claramente</strong> que el elemento est√°
          enfocado, no confundirse con otros estados.
        </p>
        <p>
          <strong>Pregunta clave:</strong> ¬øSe ve realmente enfocado?
        </p>
      </Banner>
    </section>

    <section>
      <h2>Ejemplos pr√°cticos</h2>
      <Banner title="üí° Aviso" variant="warning">
        <p>
          Los estados de foco en esta p√°gina est√°n <strong
            >forzados como est√°ticos</strong
          >
          para fines de demostraci√≥n. En un sitio real, solo aparecen cuando navegas
          con el teclado (Tab) o interact√∫as con los elementos.
        </p>
      </Banner>

      <Banner
        title="‚úÖ Outline s√≥lido negro (Pasa todas las reglas)"
        variant="good"
      >
        <div class="demo-container-white">
          <div class="demo-container">
            <div class="demo-buttons">
              <button class="demo-btn solid-black-focus"
                >Enviar formulario</button
              >
              <button class="demo-btn solid-black-focus secondary"
                >Cancelar</button
              >
              <input
                type="text"
                class="demo-input solid-black-focus"
                placeholder="Buscar componentes..."
              />
              <a href="#" class="demo-link solid-black-focus"
                >Documentaci√≥n de React</a
              >
            </div>
            <div class="demo-explanation">
              <p><strong>Por qu√© funciona:</strong></p>
              <ul>
                <li>Outline de 3px cumple el tama√±o m√≠nimo</li>
                <li>Cambio de blanco a negro: contraste 21:1</li>
                <li>Negro contra cualquier color: excelente contraste</li>
                <li>Outline cl√°sico = se√±alizador reconocible</li>
              </ul>
            </div>
          </div>
        </div>
      </Banner>

      <Banner title="‚ùå Outline azul claro (Falla contraste)" variant="bad">
        <div class="demo-container-white">
          <div class="demo-container">
            <div class="demo-buttons">
              <button class="demo-btn light-blue-focus">Instalar React</button>
              <button class="demo-btn light-blue-focus secondary"
                >Documentaci√≥n</button
              >
              <input
                type="text"
                class="demo-input light-blue-focus"
                placeholder="npm install..."
              />
              <a href="#" class="demo-link light-blue-focus"
                >Gu√≠a de TypeScript</a
              >
            </div>
            <div class="demo-explanation">
              <p><strong>Por qu√© falla:</strong></p>
              <ul>
                <li>
                  Azul claro contra blanco: solo 1.92:1 (necesita 3:1 seg√∫n <a
                    href="https://www.w3.org/WAI/WCAG22/Understanding/non-text-contrast.html"
                    target="_blank"
                    rel="noopener">WCAG 1.4.11</a
                  >)
                </li>
                <li>Azul claro contra azul oscuro: solo 2.54:1</li>
                <li>Aunque se ve familiar, no es accesible</li>
              </ul>
            </div>
          </div>
        </div>
      </Banner>

      <Banner
        title="‚úÖ Outline con gap (Estrategia inteligente)"
        variant="good"
      >
        <div class="demo-container-white">
          <div class="demo-container">
            <div class="demo-buttons">
              <button class="demo-btn gap-focus">Compilar TypeScript</button>
              <button class="demo-btn gap-focus secondary">Ver errores</button>
              <input
                type="text"
                class="demo-input gap-focus"
                placeholder="Buscar en VSCode..."
              />
              <a href="#" class="demo-link gap-focus">Manual de Astro</a>
            </div>
            <div class="demo-explanation">
              <p><strong>Por qu√© es inteligente:</strong></p>
              <ul>
                <li>El gap simplifica el contraste adyacente</li>
                <li>Solo necesitas contrastar contra el fondo</li>
                <li>Funciona en elementos de cualquier color</li>
                <li>M√°s f√°cil de mantener en todo el sitio</li>
              </ul>
            </div>
          </div>
        </div>
      </Banner>

      <Banner title="‚ùå Cambio de fondo (Confunde se√±alizadores)" variant="bad">
        <div class="demo-container-white">
          <div class="demo-container">
            <div class="demo-buttons">
              <button class="demo-btn background-change-focus"
                >Deploy a Vercel</button
              >
              <button class="demo-btn background-change-focus secondary"
                >Configurar</button
              >
              <input
                type="text"
                class="demo-input background-change-focus"
                placeholder="Nombre del proyecto..."
              />
              <a href="#" class="demo-link background-change-focus"
                >Configurar Netlify</a
              >
            </div>
            <div class="demo-explanation">
              <p><strong>Por qu√© confunde:</strong></p>
              <ul>
                <li>El bot√≥n primario enfocado parece secundario</li>
                <li>El input enfocado no parece editable</li>
                <li>Cambia la identidad visual del elemento</li>
                <li>Los usuarios no reconocen el estado</li>
              </ul>
            </div>
          </div>
        </div>
      </Banner>
    </section>

    <section>
      <h2>Estrategias recomendadas</h2>

      <BannerGrid columns="2" gap="lg">
        <Banner title="üéØ Outline s√≥lido con gap" variant="good">
          <div class="strategy-demo">
            <button class="strategy-btn demo-outline-gap"
              >Ejemplo interactivo</button
            >
          </div>
          <p>
            <strong>Ventajas:</strong> Simple, funciona en todo, f√°cil de mantener
          </p>
        </Banner>

        <Banner title="üéØ Doble outline" variant="good">
          <div class="strategy-demo">
            <button class="strategy-btn demo-double-outline"
              >Ejemplo interactivo</button
            >
          </div>
          <p>
            <strong>Ventajas:</strong> Funciona en fondos claros y oscuros
          </p>
        </Banner>

        <Banner title="‚ùå Solo cambio de color" variant="bad">
          <div class="strategy-demo">
            <button class="strategy-btn demo-color-change"
              >Ejemplo problem√°tico</button
            >
          </div>
          <p>
            <strong>Problema:</strong> Puede confundir la funci√≥n del elemento
          </p>
        </Banner>

        <Banner title="‚ùå Outline muy delgado" variant="bad">
          <div class="strategy-demo">
            <button class="strategy-btn demo-thin-outline"
              >Ejemplo problem√°tico</button
            >
          </div>
          <p>
            <strong>Problema:</strong> No cumple requisitos de tama√±o y contraste
          </p>
        </Banner>
      </BannerGrid>
    </section>

    <section>
      <h2>Casos especiales</h2>

      <BannerGrid columns="auto" minWidth="300px">
        <Banner title="üì± Elementos t√°ctiles" variant="info">
          <p>
            En dispositivos t√°ctiles, los estados de foco pueden no ser
            visibles. Aseg√∫rate de que tambi√©n funcionen con :hover y :active.
          </p>
          <div class="case-demo">
            <button class="case-btn mobile-focus">Bot√≥n t√°ctil</button>
          </div>
        </Banner>

        <Banner title="üé® Elementos personalizados" variant="info">
          <p>
            Para componentes como dropdowns o modales, aseg√∫rate de que el foco
            sea visible en todos los elementos interactivos internos.
          </p>
          <div class="case-demo">
            <div class="custom-dropdown">
              <button class="dropdown-trigger custom-focus">Abrir men√∫ ‚ñº</button
              >
              <div class="dropdown-menu">
                <a href="#" class="dropdown-item custom-focus">Opci√≥n 1</a>
                <a href="#" class="dropdown-item custom-focus">Opci√≥n 2</a>
                <a href="#" class="dropdown-item custom-focus">Opci√≥n 3</a>
              </div>
            </div>
          </div>
        </Banner>

        <Banner title="üåô Modo oscuro" variant="info">
          <p>
            En temas oscuros, usa outlines claros. El doble outline es
            especialmente √∫til para funcionar en ambos modos.
          </p>
          <div class="case-demo dark-theme">
            <button class="case-btn dark-focus">Bot√≥n modo oscuro</button>
            <input
              type="text"
              class="case-input dark-focus"
              placeholder="Input modo oscuro"
            />
          </div>
        </Banner>
      </BannerGrid>
    </section>

    <Checklist
      title="‚úÖ Antes de publicar, verifica:"
      items={checklistItems}
      variant="success"
    />

    <ToolsSection tools={focusTools}>
      <div class="tools-grid">
        <Card title="üìê Para medir contraste" variant="info" borderAccent>
          <ul>
            <li>
              <strong>Regla 3:1:</strong> Para elementos no-texto (outlines, iconos)
            </li>
            <li><strong>Regla 4.5:1:</strong> Para texto normal</li>
            <li><strong>Regla 7:1:</strong> Para texto peque√±o (AAA)</li>
          </ul>
        </Card>
      </div>
    </ToolsSection>
  </article>
</Layout>

<style lang="scss">
  article {
    max-width: 90ch;
  }

  .demo-container-white {
    background-color: white;
    padding: var(--spacing-lg);
    border-radius: 6px;
    border: 1px solid var(--color-border);
  }

  .demo-container {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--spacing-xl);
    align-items: start;
  }

  .demo-buttons {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-md);
  }

  .demo-btn {
    padding: var(--spacing-sm) var(--spacing-md);
    border: none;
    border-radius: 6px;
    font-weight: 500;
    cursor: pointer;
    background-color: var(--color-primary);
    color: white;
    transition: all 0.2s;

    &.secondary {
      background-color: transparent;
      color: var(--color-text);
      border: 1px solid var(--color-border);
    }
  }

  .demo-input {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    font-size: 0.875rem;
  }

  /* Focus styles for examples - Now forced to static state */
  .solid-black-focus {
    outline: 3px solid #000;
    outline-offset: 2px;
  }

  .light-blue-focus {
    outline: 2px solid #87ceeb;
    outline-offset: 1px;
  }

  .gap-focus {
    outline: 2px solid #0891b2;
    outline-offset: 3px;
  }

  .background-change-focus {
    background-color: white !important;
    color: var(--color-text) !important;
    outline: none;
  }

  /* Demo links - forced static focus state */
  .demo-link {
    color: var(--color-primary);
    text-decoration: underline;
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: 4px;
    display: inline-block;
    background-color: var(--color-surface);
  }

  /* Strategy demo buttons - forced static focus states */
  .strategy-btn {
    background-color: var(--color-primary);
    color: white;
    border: none;
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    margin-bottom: var(--spacing-xs);
  }

  .demo-outline-gap {
    outline: 2px solid #000;
    outline-offset: 2px;
  }

  .demo-double-outline {
    outline: 2px solid #fff;
    box-shadow: 0 0 0 4px #000;
    outline-offset: 1px;
  }

  .demo-color-change {
    background-color: #f0f0f0;
    color: var(--color-text);
    outline: none;
  }

  .demo-thin-outline {
    outline: 1px dashed #ccc;
  }

  /* Case demo elements - forced static focus states */
  .case-btn {
    background-color: var(--color-primary);
    color: white;
    border: none;
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
    margin-bottom: var(--spacing-xs);
  }

  .case-input {
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    font-size: 0.875rem;
    margin-bottom: var(--spacing-xs);

    &::placeholder {
      color: #9ca3af;
    }
  }

  .mobile-focus {
    outline: 2px solid #000;
    outline-offset: 2px;
  }

  /* Custom dropdown */
  .custom-dropdown {
    position: relative;
    display: inline-block;
  }

  .dropdown-trigger {
    background-color: var(--color-primary);
    color: white;
    border: none;
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: 6px;
    cursor: pointer;
    font-weight: 500;
  }

  .dropdown-menu {
    position: absolute;
    top: 100%;
    left: 0;
    background-color: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: 6px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    z-index: 10;
    min-width: 150px;
    margin-top: var(--spacing-xs);
  }

  .dropdown-item {
    display: block;
    padding: var(--spacing-sm) var(--spacing-md);
    color: var(--color-text);
    text-decoration: none;
    border-radius: 4px;
    margin: var(--spacing-xs);
    background-color: var(--color-background);
  }

  .custom-focus {
    outline: 2px solid #000;
    outline-offset: 1px;
  }

  /* Dark theme demo */
  .dark-theme {
    background-color: #1e293b;
    color: #e2e8f0;
    padding: var(--spacing-md);
    border-radius: 6px;

    .case-btn {
      background-color: #3b82f6;
    }

    .case-input {
      background-color: #374151;
      border-color: #6b7280;
      color: #e2e8f0;

      &::placeholder {
        color: #9ca3af;
      }
    }
  }

  .dark-focus {
    outline: 2px solid #fff;
    outline-offset: 2px;
  }

  .demo-note {
    font-style: italic;
    color: var(--color-text-light);
    margin-bottom: var(--spacing-md);
  }

  /* Estilo para elementos kbd dentro de Banner */
  :global(.banner kbd) {
    background-color: #374151;
    color: white;
    padding: 2px 6px;
    border-radius: 3px;
    font-family: monospace;
    font-size: 0.875rem;
  }

  .demo-explanation {
    background-color: var(--color-background);
    padding: var(--spacing-md);
    border-radius: 6px;

    ul {
      margin: var(--spacing-sm) 0 0 0;
      padding-left: var(--spacing-lg);
    }

    li {
      margin-bottom: var(--spacing-xs);
      font-size: 0.875rem;
    }
  }

  .strategy-demo {
    margin-bottom: var(--spacing-md);
  }

  .case-demo {
    margin-bottom: var(--spacing-md);
  }

  .tools-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--spacing-lg);
    margin: var(--spacing-lg) 0;
  }

  @media (max-width: 768px) {
    .demo-container {
      grid-template-columns: 1fr;
      gap: var(--spacing-lg);
    }

    .tools-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
